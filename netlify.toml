# Netlify Configuration - Force Deploy v2
[build]
  publish = "dist"
  command = "npm run build && node scripts/prebundle-remotion.js"

# Netlify Functions configuration
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"
  # External dependencies for Remotion
  external_node_modules = [
    "@remotion/bundler",
    "@remotion/renderer", 
    "@remotion/studio",
    "@remotion/media-parser",
    "puppeteer-core",
    "@sparticuz/chromium",
    "react",
    "remotion",
    "source-map"
  ]
  # Include Remotion source files and Chromium package
  included_files = [
    "remotion/**",
    "node_modules/@sparticuz/**",
    ".remotion-bundle/**"
  ]

# Dev server settings
[dev]
  functions = "netlify/functions"
  functionsPort = 8888
  # Increase function timeout for video rendering (local development only)
  # Note: Production Netlify has a 10s limit on free tier
  functionsTimeout = 60

# Ensure LinkedIn sees correct HTML content type for proxied Supabase function
[[headers]]
  for = "/functions/v1/social-share"
  [headers.values]
    Content-Type = "text/html; charset=utf-8"

# Note: Redirects are handled in public/_redirects file
# This is more reliable for proxying external services
